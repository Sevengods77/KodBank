<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kodbank - Dashboard</title>
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
</head>

<body>
    <div class="wide-card">
        <!-- Sidebar Navigation -->
        <div class="sidebar">
            <div class="sidebar-top">
                <div class="brand" style="font-size: 1.5rem; text-align: left; margin-bottom: 2rem;">Kodbank</div>
                <nav class="sidebar-nav">
                    <a href="#" class="nav-item active">Overview</a>
                    <a href="#" class="nav-item">Transactions</a>
                    <a href="#" class="nav-item">Cards</a>
                    <a href="#" class="nav-item">Payments</a>
                </nav>
            </div>
            <button id="logout-btn" class="logout-btn-proper">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                    stroke-linecap="round" stroke-linejoin="round">
                    <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path>
                    <polyline points="16 17 21 12 16 7"></polyline>
                    <line x1="21" y1="12" x2="9" y2="12"></line>
                </svg>
                Sign Out Securely
            </button>
        </div>

        <!-- Main Dashboard Content -->
        <div class="main-content">
            <header style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 3rem;">
                <div>
                    <h2 style="font-size: 1.5rem; font-weight: 700;">Dashboard Overview</h2>
                    <p style="color: var(--text-muted); font-size: 0.875rem;">Welcome back to your premium account.</p>
                </div>
                <div
                    style="width: 40px; height: 40px; border-radius: 50%; background: var(--primary); display: flex; align-items: center; justify-content: center; font-weight: 700;">
                    U</div>
            </header>

            <div
                style="background: rgba(255,255,255,0.02); border: 1px solid var(--glass-border); border-radius: 1.5rem; padding: 2.5rem; text-align: center;">
                <h3 style="margin-bottom: 1rem; font-weight: 600;">Account Liquidity</h3>
                <p style="color: var(--text-muted); margin-bottom: 2.5rem; font-size: 0.9rem;">Check your real-time
                    available balance.</p>

                <button id="check-balance-btn" class="btn-primary" style="padding: 1rem 3rem;">Check Available
                    Balance</button>

                <div id="balance-display" class="balance-card">
                    <p
                        style="color: var(--text-muted); text-transform: uppercase; font-size: 0.65rem; font-weight: 700; letter-spacing: 0.1em;">
                        Total Balance</p>
                    <div class="balance-amount" id="balance-amount-text">₹0</div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <script>
        document.getElementById('check-balance-btn').addEventListener('click', async () => {
            const btn = document.getElementById('check-balance-btn');
            btn.disabled = true;
            btn.textContent = 'Verifying...';

            try {
                const response = await fetch('/api/balance');
                if (response.ok) {
                    const data = await response.json();
                    const display = document.getElementById('balance-display');
                    const amountText = document.getElementById('balance-amount-text');

                    amountText.innerHTML = `₹${data.balance}`;
                    display.style.display = 'block';
                    btn.style.display = 'none';

                    // Proper Explosive Party Popper
                    const duration = 5 * 1000;
                    const animationEnd = Date.now() + duration;
                    const defaults = { startVelocity: 30, spread: 360, ticks: 60, zIndex: 0 };

                    function randomInRange(min, max) {
                        return Math.random() * (max - min) + min;
                    }

                    const interval = setInterval(function () {
                        const timeLeft = animationEnd - Date.now();

                        if (timeLeft <= 0) {
                            return clearInterval(interval);
                        }

                        const particleCount = 50 * (timeLeft / duration);

                        confetti(Object.assign({}, defaults, {
                            particleCount,
                            origin: { x: randomInRange(0.1, 0.3), y: Math.random() - 0.2 },
                            colors: ['#3b82f6', '#10b981', '#ffffff', '#a855f7']
                        }));
                        confetti(Object.assign({}, defaults, {
                            particleCount,
                            origin: { x: randomInRange(0.7, 0.9), y: Math.random() - 0.2 },
                            colors: ['#3b82f6', '#10b981', '#ffffff', '#a855f7']
                        }));
                    }, 250);
                } else {
                    window.location.href = '/login';
                }
            } catch (err) {
                console.error(err);
                btn.disabled = false;
                btn.textContent = 'Check Balance';
            }
        });

        document.getElementById('logout-btn').addEventListener('click', () => {
            document.cookie = "auth_token=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;";
            window.location.href = '/login';
        });
    </script>
</body>

</html>